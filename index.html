<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ActivTrak Discount Calculator</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.5;
            color: #333;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 24px;
        }
        
        h1 {
            font-size: 24px;
            color: #1a56db;
            margin-top: 0;
            margin-bottom: 24px;
        }
        
        .settings-panel {
            background-color: #f9fafb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }
        
        .settings-panel h2 {
            font-size: 18px;
            margin-top: 0;
            margin-bottom: 12px;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            align-items: flex-end;
        }
        
        .control-group {
            margin-bottom: 8px;
        }
        
        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        input, select {
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
        }
        
        input[type="number"] {
            width: 100px;
        }
        
        .number-input {
            text-align: right;
            width: 100px;
        }
        
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }
        
        .btn-primary {
            background-color: #1a56db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1e429f;
        }
        
        .btn-secondary {
            background-color: #e5e7eb;
            color: #1f2937;
        }
        
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        
        .btn-success {
            background-color: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #059669;
        }
        
        .btn-danger {
            background-color: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #dc2626;
        }
        
        .table-container {
            overflow-x: auto;
            margin-bottom: 24px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        th, td {
            padding: 10px;
            border-bottom: 1px solid #e5e7eb;
            text-align: left;
        }
        
        th {
            background-color: #f9fafb;
            font-weight: 600;
        }
        
        tr:hover {
            background-color: #f9fafb;
        }
        
        .text-right {
            text-align: right;
        }
        
        .text-center {
            text-align: center;
        }
        
        tfoot {
            font-weight: 600;
            background-color: #f9fafb;
        }
        
        .summary-panel {
            background-color: #eff6ff;
            border-radius: 8px;
            padding: 16px;
        }
        
        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        
        .summary-header h2 {
            font-size: 18px;
            margin: 0;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .summary-card {
            background-color: white;
            border-radius: 6px;
            padding: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .summary-label {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 4px;
        }
        
        .summary-value {
            font-size: 20px;
            font-weight: 700;
        }
        
        .summary-input {
            width: 100%;
            padding: 4px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 20px;
            font-weight: 700;
            text-align: right;
        }
        
        .summary-subtext {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }
        
        .highlight-section {
            background-color: #dbeafe;
            border-radius: 6px;
            padding: 12px;
        }
        
        .editable-total {
            width: 100%;
            text-align: right;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            padding: 4px;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            input, select {
                width: 100%;
            }
            
            input[type="number"] {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ActivTrak Discount Allocation Calculator</h1>
        
        <div class="settings-panel">
            <h2>Target Discount Settings</h2>
            <div class="controls">
                <div class="control-group">
                    <label for="target-discount">Target Overall Discount (%)</label>
                    <input
                        type="number"
                        id="target-discount"
                        min="0"
                        max="99.99"
                        step="0.01"
                        value="30"
                    />
                </div>
                
                <div class="control-group">
                    <label for="distribution-method">Distribution Method</label>
                    <select id="distribution-method">
                        <option value="proportional">Proportional (Maintain Ratios)</option>
                        <option value="priority">Priority (Highest Value First)</option>
                        <option value="equal">Equal (Same % Across All)</option>
                    </select>
                </div>
                
                <button id="apply-discount" class="btn-primary">
                    Apply Target Discount
                </button>
                
                <button id="reset-discount" class="btn-secondary">
                    Reset
                </button>
                
                <button id="add-product" class="btn-success">
                    Add Product
                </button>
            </div>
        </div>
        
        <div class="table-container">
            <table id="products-table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th class="text-right">Quantity</th>
                        <th class="text-right">List Price ($)</th>
                        <th class="text-right">Total List Value ($)</th>
                        <th class="text-right" colspan="2">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Discount (%)</span>
                                <span>Sales Price ($)</span>
                            </div>
                        </th>
                        <th class="text-right">Total Sales Value ($)</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody id="products-body">
                    <!-- Product rows will be added here -->
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="2">Totals</td>
                        <td class="text-right">
                            <input
                                type="number"
                                id="total-list-price"
                                class="editable-total"
                                min="0"
                                step="0.01"
                            />
                        </td>
                        <td class="text-right" id="total-list-value">0.00</td>
                        <td class="text-right" colspan="2" id="overall-discount">0.00%</td>
                        <td class="text-right" id="total-sales-value">0.00</td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        
        <div class="summary-panel">
            <div class="summary-header">
                <h2>Contract Summary</h2>
                <div class="control-group">
                    <label for="contract-months">Contract Term (Months):</label>
                    <input
                        type="number"
                        id="contract-months"
                        min="1"
                        max="60"
                        value="12"
                    />
                </div>
            </div>
            
            <div class="summary-grid">
                <div class="summary-card">
                    <div class="summary-label">Monthly List Value</div>
                    <div class="summary-value" id="monthly-list-value">$0.00</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Monthly Sales Value</div>
                    <div class="summary-value" id="monthly-sales-value">$0.00</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Monthly Savings</div>
                    <div class="summary-value" id="monthly-savings">$0.00</div>
                    <div class="summary-subtext" id="monthly-discount">0.00% discount</div>
                </div>
            </div>
            
            <div class="highlight-section">
                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="summary-label">Total Contract List Value</div>
                        <div class="summary-value" id="contract-list-value">$0.00</div>
                        <div class="summary-subtext" id="contract-months-text">12 months</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-label">Total Contract Sales Value</div>
                        <div class="summary-value">
                            <input
                                type="number"
                                id="contract-sales-value"
                                class="summary-input"
                                min="0"
                                step="0.01"
                                value="0.00"
                            />
                        </div>
                        <div class="summary-subtext" id="contract-months-sales-text">12 months</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-label">Total Contract Savings</div>
                        <div class="summary-value" id="contract-savings">$0.00</div>
                        <div class="summary-subtext" id="contract-months-savings-text">12 months</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Product class to handle individual product calculations
        class Product {
            constructor(id, name, quantity, listPrice, discount) {
                this.id = id;
                this.name = name;
                this.quantity = quantity;
                this.listPrice = listPrice;
                this.discount = discount;
                this.salesPrice = this.calculateSalesPrice();
            }
            
            calculateSalesPrice() {
                return parseFloat((this.listPrice * (1 - this.discount / 100)).toFixed(2));
            }
            
            calculateTotalListValue() {
                return parseFloat((this.quantity * this.listPrice).toFixed(2));
            }
            
            calculateTotalSalesValue() {
                return parseFloat((this.quantity * this.salesPrice).toFixed(2));
            }
            
            updateDiscount(discount) {
                this.discount = discount;
                this.salesPrice = this.calculateSalesPrice();
            }
            
            updateSalesPrice(salesPrice) {
                this.salesPrice = salesPrice;
                if (this.listPrice > 0) {
                    this.discount = parseFloat((((this.listPrice - this.salesPrice) / this.listPrice) * 100).toFixed(2));
                    // Cap discount at 99.99%
                    this.discount = Math.min(99.99, this.discount);
                } else {
                    this.discount = 0;
                }
            }
            
            updateListPrice(listPrice) {
                this.listPrice = listPrice;
                this.salesPrice = this.calculateSalesPrice();
            }
            
            updateQuantity(quantity) {
                this.quantity = quantity;
            }
        }
        
        // Calculator class to manage the entire calculator
        class DiscountCalculator {
            constructor() {
                this.products = [];
                this.nextId = 1;
                this.months = 12;
                this.targetDiscount = 30;
                this.distributionMethod = 'proportional';
                
                this.initEventListeners();
                this.loadInitialProducts();
                this.render();
            }
            
            initEventListeners() {
                // Settings panel buttons
                document.getElementById('apply-discount').addEventListener('click', () => this.applyTargetDiscount());
                document.getElementById('reset-discount').addEventListener('click', () => this.resetToInitial());
                document.getElementById('add-product').addEventListener('click', () => this.addProduct());
                
                // Target discount and distribution method
                document.getElementById('target-discount').addEventListener('change', (e) => {
                    this.targetDiscount = parseFloat(e.target.value) || 0;
                });
                document.getElementById('target-discount').className = 'number-input';
                
                document.getElementById('distribution-method').addEventListener('change', (e) => {
                    this.distributionMethod = e.target.value;
                });
                
                // Contract months
                document.getElementById('contract-months').addEventListener('change', (e) => {
                    this.months = parseInt(e.target.value) || 1;
                    this.render();
                });
                document.getElementById('contract-months').className = 'number-input';
                
                // Total list price input
                document.getElementById('total-list-price').addEventListener('change', (e) => {
                    const newTotalListValue = parseFloat(e.target.value);
                    if (!isNaN(newTotalListValue)) {
                        this.adjustToTargetListValue(newTotalListValue);
                    }
                });
                document.getElementById('total-list-price').className = 'editable-total number-input';
                
                // Contract sales value input
                document.getElementById('contract-sales-value').addEventListener('change', (e) => {
                    const newTotalSalesValue = parseFloat(e.target.value);
                    if (!isNaN(newTotalSalesValue)) {
                        this.adjustToTargetSalesValue(newTotalSalesValue);
                    }
                });
                document.getElementById('contract-sales-value').className = 'summary-input number-input';
            }
            
            loadInitialProducts() {
                // Initial products from the screenshot
                this.addProduct('ActivTrak Professional', 160, 19.00, 23.95);
                this.addProduct('Premier Support', 160, 1.50, 50.00);
                this.addProduct('Screen Details', 160, 2.00, 50.00);
            }
            
            addProduct(name = 'New Product', quantity = 1, listPrice = 0.00, discount = 0.00) {
                const product = new Product(this.nextId++, name, quantity, listPrice, discount);
                this.products.push(product);
                this.render();
                return product;
            }
            
            removeProduct(id) {
                this.products = this.products.filter(product => product.id !== id);
                this.render();
            }
            
            calculateTotals() {
                let totalListValue = 0;
                let totalSalesValue = 0;
                
                this.products.forEach(product => {
                    totalListValue += product.calculateTotalListValue();
                    totalSalesValue += product.calculateTotalSalesValue();
                });
                
                const overallDiscount = totalListValue > 0 
                    ? ((totalListValue - totalSalesValue) / totalListValue) * 100 
                    : 0;
                
                return {
                    totalListValue,
                    totalSalesValue,
                    overallDiscount
                };
            }
            
            applyTargetDiscount() {
                switch (this.distributionMethod) {
                    case 'proportional':
                        this.applyProportionalDiscount();
                        break;
                    case 'priority':
                        this.applyPriorityDiscount();
                        break;
                    case 'equal':
                        this.applyEqualDiscount();
                        break;
                }
                
                this.render();
            }
            
            applyProportionalDiscount() {
                const { totalListValue, totalSalesValue, overallDiscount } = this.calculateTotals();
                
                if (totalListValue === 0) return;
                
                // If current discount is 0, apply equal discount
                if (overallDiscount === 0) {
                    this.applyEqualDiscount();
                    return;
                }
                
                const adjustmentFactor = this.targetDiscount / overallDiscount;
                
                this.products.forEach(product => {
                    let newDiscount = product.discount * adjustmentFactor;
                    // Cap at 99.99%
                    newDiscount = Math.min(99.99, newDiscount);
                    product.updateDiscount(newDiscount);
                });
            }
            
            applyPriorityDiscount() {
                const { totalListValue, totalSalesValue } = this.calculateTotals();
                
                if (totalListValue === 0) return;
                
                // Sort products by price (highest to lowest)
                const sortedProducts = [...this.products].sort((a, b) => 
                    (b.listPrice * b.quantity) - (a.listPrice * a.quantity)
                );
                
                const targetValue = totalListValue * (1 - this.targetDiscount / 100);
                let currentValue = totalSalesValue;
                
                for (const product of sortedProducts) {
                    if (Math.abs(currentValue - targetValue) < 0.01) break;
                    
                    const productListValue = product.calculateTotalListValue();
                    
                    if (currentValue > targetValue) {
                        // Need to increase discount
                        const additionalDiscountNeeded = (currentValue - targetValue) / productListValue * 100;
                        const newDiscount = Math.min(99.99, product.discount + additionalDiscountNeeded);
                        const originalSalesValue = product.calculateTotalSalesValue();
                        product.updateDiscount(newDiscount);
                        const newSalesValue = product.calculateTotalSalesValue();
                        currentValue = currentValue - (originalSalesValue - newSalesValue);
                    } else {
                        // Need to decrease discount
                        const discountReduction = (targetValue - currentValue) / productListValue * 100;
                        const newDiscount = Math.max(0, product.discount - discountReduction);
                        const originalSalesValue = product.calculateTotalSalesValue();
                        product.updateDiscount(newDiscount);
                        const newSalesValue = product.calculateTotalSalesValue();
                        currentValue = currentValue + (newSalesValue - originalSalesValue);
                    }
                }
            }
            
            applyEqualDiscount() {
                this.products.forEach(product => {
                    product.updateDiscount(this.targetDiscount);
                });
            }
            
            adjustToTargetListValue(targetTotalListValue) {
                const { totalListValue } = this.calculateTotals();
                
                if (totalListValue === 0) return;
                
                const adjustmentFactor = targetTotalListValue / totalListValue;
                
                this.products.forEach(product => {
                    const newListPrice = product.listPrice * adjustmentFactor;
                    product.updateListPrice(newListPrice);
                });
                
                this.render();
            }
            
            adjustToTargetSalesValue(targetContractSalesValue) {
                const { totalSalesValue } = this.calculateTotals();
                
                if (totalSalesValue === 0) return;
                
                const targetMonthlySalesValue = targetContractSalesValue / this.months;
                const adjustmentFactor = targetMonthlySalesValue / totalSalesValue;
                
                this.products.forEach(product => {
                    const newSalesPrice = product.salesPrice * adjustmentFactor;
                    product.updateSalesPrice(newSalesPrice);
                });
                
                this.render();
            }
            
            resetToInitial() {
                this.products = [];
                this.nextId = 1;
                this.loadInitialProducts();
            }
            
            renderProductRow(product) {
                const row = document.createElement('tr');
                
                // Product name cell
                const nameCell = document.createElement('td');
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.value = product.name;
                nameInput.className = 'text-input';
                nameInput.addEventListener('input', (e) => {
                    product.name = e.target.value;
                });
                nameCell.appendChild(nameInput);
                
                // Quantity cell
                const quantityCell = document.createElement('td');
                quantityCell.className = 'text-right';
                const quantityInput = document.createElement('input');
                quantityInput.type = 'number';
                quantityInput.value = product.quantity;
                quantityInput.min = '1';
                quantityInput.className = 'number-input';
                quantityInput.addEventListener('change', (e) => {
                    const value = parseInt(e.target.value) || 0;
                    product.updateQuantity(value);
                    this.render();
                });
                quantityCell.appendChild(quantityInput);
                
                // List price cell
                const listPriceCell = document.createElement('td');
                listPriceCell.className = 'text-right';
                const listPriceInput = document.createElement('input');
                listPriceInput.type = 'number';
                listPriceInput.value = product.listPrice.toFixed(2);
                listPriceInput.min = '0';
                listPriceInput.step = '0.01';
                listPriceInput.className = 'number-input';
                listPriceInput.addEventListener('change', (e) => {
                    const value = parseFloat(e.target.value) || 0;
                    product.updateListPrice(value);
                    this.render();
                });
                listPriceCell.appendChild(listPriceInput);
                
                // Total list value cell
                const totalListValueCell = document.createElement('td');
                totalListValueCell.className = 'text-right';
                totalListValueCell.textContent = product.calculateTotalListValue().toFixed(2);
                
                // Discount and sales price cell (combined)
                const discountSalesPriceCell = document.createElement('td');
                discountSalesPriceCell.className = 'text-right';
                discountSalesPriceCell.colSpan = 2;
                
                const flexContainer = document.createElement('div');
                flexContainer.style.display = 'flex';
                flexContainer.style.justifyContent = 'space-between';
                flexContainer.style.alignItems = 'center';
                
                const discountInput = document.createElement('input');
                discountInput.type = 'number';
                discountInput.value = product.discount.toFixed(2);
                discountInput.min = '0';
                discountInput.max = '99.99';
                discountInput.step = '0.01';
                discountInput.style.width = '40%';
                discountInput.className = 'number-input';
                discountInput.addEventListener('change', (e) => {
                    const value = parseFloat(e.target.value) || 0;
                    product.updateDiscount(value);
                    this.render();
                });
                
                const salesPriceInput = document.createElement('input');
                salesPriceInput.type = 'number';
                salesPriceInput.value = product.salesPrice.toFixed(2);
                salesPriceInput.min = '0';
                salesPriceInput.step = '0.01';
                salesPriceInput.style.width = '40%';
                salesPriceInput.className = 'number-input';
                salesPriceInput.addEventListener('change', (e) => {
                    const value = parseFloat(e.target.value) || 0;
                    product.updateSalesPrice(value);
                    this.render();
                });
                
                flexContainer.appendChild(discountInput);
                flexContainer.appendChild(salesPriceInput);
                discountSalesPriceCell.appendChild(flexContainer);
                
                // Total sales value cell
                const totalSalesValueCell = document.createElement('td');
                totalSalesValueCell.className = 'text-right';
                totalSalesValueCell.textContent = product.calculateTotalSalesValue().toFixed(2);
                
                // Actions cell
                const actionsCell = document.createElement('td');
                actionsCell.className = 'text-center';
                const removeButton = document.createElement('button');
                removeButton.textContent = 'Remove';
                removeButton.className = 'btn-danger';
                removeButton.addEventListener('click', () => this.removeProduct(product.id));
                actionsCell.appendChild(removeButton);
                
                // Add all cells to the row
                row.appendChild(nameCell);
                row.appendChild(quantityCell);
                row.appendChild(listPriceCell);
                row.appendChild(totalListValueCell);
                row.appendChild(discountSalesPriceCell);
                row.appendChild(totalSalesValueCell);
                row.appendChild(actionsCell);
                
                return row;
            }
            
            render() {
                // Clear existing products
                const tbody = document.getElementById('products-body');
                tbody.innerHTML = '';
                
                // Add each product row
                this.products.forEach(product => {
                    tbody.appendChild(this.renderProductRow(product));
                });
                
                // Calculate and update totals
                const { totalListValue, totalSalesValue, overallDiscount } = this.calculateTotals();
                
                // Update totals in the table footer
                document.getElementById('total-list-price').value = totalListValue.toFixed(2);
                document.getElementById('total-list-value').textContent = totalListValue.toFixed(2);
                document.getElementById('overall-discount').textContent = overallDiscount.toFixed(2) + '%';
                document.getElementById('total-sales-value').textContent = totalSalesValue.toFixed(2);
                
                // Update summary section
                document.getElementById('monthly-list-value').textContent = '$' + totalListValue.toFixed(2);
                document.getElementById('monthly-sales-value').textContent = '$' + totalSalesValue.toFixed(2);
                document.getElementById('monthly-savings').textContent = '$' + (totalListValue - totalSalesValue).toFixed(2);
                document.getElementById('monthly-discount').textContent = overallDiscount.toFixed(2) + '% discount';
                
                // Update contract values
                document.getElementById('contract-list-value').textContent = '$' + (totalListValue * this.months).toFixed(2);
                document.getElementById('contract-sales-value').value = (totalSalesValue * this.months).toFixed(2);
                document.getElementById('contract-savings').textContent = '$' + ((totalListValue - totalSalesValue) * this.months).toFixed(2);
                
                // Update month texts
                document.getElementById('contract-months-text').textContent = this.months + ' months';
                document.getElementById('contract-months-sales-text').textContent = this.months + ' months';
                document.getElementById('contract-months-savings-text').textContent = this.months + ' months';
            }
        }
        
        // Initialize the calculator when the DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new DiscountCalculator();
        });
    </script>
</body>
</html>
